(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{105:function(e,t,n){},107:function(e,t,n){"use strict";n.r(t);n(52);var a=n(0),o=n.n(a),r=n(46),i=n.n(r),c=n(10),s=n(11),u=n.n(s),l=n(30),d=n(3),p=n(4),h=n(6),f=n(5),g=n(7),b=n(2);n(60),n(62);var v=["multiRouter.MultiRoute","geocode","geoObject.addon.balloon","templateLayoutFactory"],m={center:[55.75,37.57],zoom:12},j=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(h.a)(this,Object(f.a)(t).call(this,e))).container=o.a.createRef(),n.ymaps=null,n.state={loaded:!1},n.handleLoad=n.handleLoad.bind(Object(b.a)(Object(b.a)(n))),n.handleRouteRequestSuccess=n.handleRouteRequestSuccess.bind(Object(b.a)(Object(b.a)(n))),n.updateMapCenter=n.updateMapCenter.bind(Object(b.a)(Object(b.a)(n))),n}return Object(g.a)(t,e),Object(p.a)(t,[{key:"componentDidUpdate",value:function(e){var t=this;if(this.ymaps){var n=this.props.locations;this.updateRoute(n),n.length>e.locations.length&&this.initialRoute.model.events.once("requestsuccess",function(){var e=t.initialRoute.getWayPoints(),n=e.get(e.getLength()-1);t.updateMapCenter(n.geometry.getCoordinates())})}}},{key:"updateMapCenter",value:function(e){this.map.setCenter(e,m.zoom,{duration:500})}},{key:"updateRoute",value:function(e){var t=e.map(function(e){return 0!==e.coords.length?e.coords:e.value});this.initialRoute.model.setReferencePoints(t)}},{key:"handleRouteRequestSuccess",value:function(e,t){var n,a=this.initialRoute.getWayPoints().toArray(),o=this.props.locations;(a.length===o.length&&(n=function(e,t){var n=t.slice(0),a=function(t){var a=e[t],o=n.findIndex(function(e){return function(e,t){if(0!==e.coords.length){var n=t.geometry.getCoordinates();return e.coords[0]===n[0]&&e.coords[1]===n[1]}return e.value===t.properties.get("request")}(a,e)});if(-1===o&&0!==n.length){var r=n[0];return{v:{index:t,coords:r.geometry.getCoordinates(),address:r.properties.get("address"),request:r.properties.get("request")}}}if(0===n.length)return"break";n.splice(o,1)};e:for(var o=0;o<e.length;o++){var r=a(o);switch(r){case"break":break e;default:if("object"===typeof r)return r.v}}return null}(this.props.locations,a.slice(0))),console.group("Route request success"),console.count("Route updated (times)"),console.log("Is first route request: "+t.get("init")),console.log(a),console.log(n),console.groupEnd("Route request success"),n)&&(0,this.props.onWayPointDrag)(n.index,{coords:n.coords});a.forEach(function(t){e.geoObject.addon.balloon.get(t)})}},{key:"handleLoad",value:function(e){var t=this;this.ymaps=e;var n=this.props.locations;this.initialRoute=new e.multiRouter.MultiRoute({referencePoints:n.map(function(e){return e.value}),params:{results:1}},function(e){return{wayPointDraggable:!0,preventDragUpdate:!0,routeStrokeColor:"#a051cf",routeActiveStrokeColor:"#a051cf",routeOpacity:1,routeOpenBalloonOnClick:!1,wayPointBalloonContentLayout:e.templateLayoutFactory.createClass("{{ properties.address|raw }}")}}(e)),this.initialRoute.model.events.add("requestsuccess",function(n){t.handleRouteRequestSuccess(e,n)}),this.setState({loaded:!0}),this.map.geoObjects.add(this.initialRoute)}},{key:"render",value:function(){var e=this,t=this.props.className,n=void 0===t?"":t,a=this.state.loaded?"":"MapContainer_status_loading";return o.a.createElement("div",{className:"\n          MapContainer\n          App-MapContainer\n          ".concat(n,"\n          ").concat(a,"\n          MapContainer_size_fluid\n          MapContainer_max-size_md\n        ")},o.a.createElement(c.Map,{className:"Map",modules:v,defaultState:m,onLoad:this.handleLoad,instanceRef:function(t){return e.map=t}}))}}]),t}(a.Component),O=(n(64),function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(h.a)(this,Object(f.a)(t).call(this,e))).state={value:""},n.handleChange=n.handleChange.bind(Object(b.a)(Object(b.a)(n))),n.handleSubmit=n.handleSubmit.bind(Object(b.a)(Object(b.a)(n))),n}return Object(g.a)(t,e),Object(p.a)(t,[{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"handleSubmit",value:function(e){var t=this.state.value;this.props.onSubmit(t),this.setState({value:""}),e.preventDefault()}},{key:"render",value:function(){return o.a.createElement("form",{className:"App-Form",onSubmit:this.handleSubmit},o.a.createElement("input",{className:"PointInput",type:"text",value:this.state.value,onChange:this.handleChange,placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0430\u0434\u0440\u0435\u0441..."}))}}]),t}(a.Component)),y=n(32),E=(n(66),n(20)),w=function(e){function t(){return Object(d.a)(this,t),Object(h.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props,t=e.locations,n=e.onDelete,a=this.props,r=a.provided,i=a.innerRef,c=(r||{}).droppableProps,s=this.props.children||t.map(function(e){return o.a.createElement(k,{location:e,onDelete:n,key:e.id})});return o.a.createElement("ul",Object.assign({className:"PointList App-PointList",ref:i},c),s)}}]),t}(o.a.Component);function P(e){var t=e.onDragEnd,n=Object(y.a)(e,["onDragEnd"]);return o.a.createElement(E.a,{onDragEnd:function(e){if(e.destination){var n=e.source.index,a=e.destination.index;t(n,a)}}},o.a.createElement(E.c,{droppableId:"PointList-1"},function(e){return o.a.createElement(w,{provided:e,innerRef:e.innerRef},n.locations.map(function(e,t){return o.a.createElement(C,{id:e.id,index:t,location:e,onDelete:n.onDelete,key:e.id})}),e.placeholder)}))}var k=function(e){function t(){return Object(d.a)(this,t),Object(h.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(p.a)(t,[{key:"render",value:function(){var e=this.props,t=e.location,n=e.onDelete,a=this.props,r=a.provided,i=a.innerRef,c=r||{},s=c.draggableProps,u=c.dragHandleProps;return o.a.createElement("li",Object.assign({className:"PointList-Item Item"},s,{ref:i}),o.a.createElement("div",Object.assign({className:"Item-Icon"},u)),o.a.createElement("div",{className:"Item-Location"},t.value),o.a.createElement("button",{className:"Item-Button Item-Button_action_remove",onClick:function(){return n(t.id)}}))}}]),t}(o.a.Component);function C(e){var t=e.id,n=e.index,a=Object(y.a)(e,["id","index"]);return o.a.createElement(E.b,{draggableId:t,index:n},function(e){return o.a.createElement(k,Object.assign({provided:e,placeholder:e.placeholder,innerRef:e.innerRef},a))})}n(105);var L=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(h.a)(this,Object(f.a)(t).call(this,e))).state={label:""},n.handleToggle=n.handleToggle.bind(Object(b.a)(Object(b.a)(n))),n}return Object(g.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.initialLabel;this.setState(function(t){return{label:e}})}},{key:"handleToggle",value:function(){var e=this.props,t=e.onToggle,n=e.initialLabel,a=e.toggledLabel;this.setState(function(e){return{label:e.label===n?a:n}}),t()}},{key:"render",value:function(){var e=this.state.label;return o.a.createElement("button",{className:"ScreenToggler App-ScreenToggler",onClick:this.handleToggle},e)}}]),t}(o.a.Component),R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(void 0===t)throw new Error("MisiingArgument: Expected to get an address arg, but undefined encountered");var a={id:e,coords:n,value:t};return e+=1,a}};function S(e,t){if(void 0===t.value||void 0===t.id)throw new Error("InvalidArgument: provided object does not match the location point signature");return e.concat([t])}function x(e,t,n){if(t<0||t>=e.length)throw new Error("RangeError: Trying to access element being out of the locations array range");if("object"!==typeof n)throw new Error("SignatureError: Expected to get the second argument as an object");if(n&&!Array.isArray(n.coords)&&!n.value)throw new Error("ArgumentSignatureError: Expected to get the second update arg with either address or coordinates or both, but no defined property encountered");var a=e.slice(0);return a[t]=Object.assign({},a[t],n),a}var A=["App-PointList","App-MapContainer"],M=function(e,t){return e!==t?"is-hidden":""},D=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(h.a)(this,Object(f.a)(t).call(this,e))).state={locations:[],activeView:A[0]},n.createLocationPoint=R(),n.toggleView=n.toggleView.bind(Object(b.a)(Object(b.a)(n))),n.addLocationPoint=n.addLocationPoint.bind(Object(b.a)(Object(b.a)(n))),n.deleteLocationPoint=n.deleteLocationPoint.bind(Object(b.a)(Object(b.a)(n))),n.moveLocationPoint=n.moveLocationPoint.bind(Object(b.a)(Object(b.a)(n))),n.updateLocationPoint=n.updateLocationPoint.bind(Object(b.a)(Object(b.a)(n))),n}return Object(g.a)(t,e),Object(p.a)(t,[{key:"fetch",value:function(e){return(0,this.props.ymaps.geocode)(e,{results:1})}},{key:"fetchPointCoords",value:function(e){return this.fetch(e).then(function(e){return e.geoObjects.get(0).geometry.getCoordinates()})}},{key:"fetchPointAddress",value:function(e){return this.fetch(e).then(function(e){return e.geoObjects.get(0).getAddressLine()})}},{key:"toggleView",value:function(){this.setState(function(e){return{activeView:(t=e.activeView,t===A[0]?A[1]:A[0])};var t})}},{key:"addLocationPoint",value:function(){var e=Object(l.a)(u.a.mark(function e(t){var n,a,o,r=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchPointCoords(t);case 2:return n=e.sent,a=this.createLocationPoint(t,n),o=function(e){return{locations:S(e.locations,a)}},e.abrupt("return",new Promise(function(e,t){try{r.setState(o,function(){e(a)})}catch(n){t(n)}}));case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"deleteLocationPoint",value:function(e){this.setState(function(t){return{locations:function(e,t){if(void 0===t)throw new Error("MissingArgument: Expected to get a point id as the second argument, but undefined encountered");return e.filter(function(e){return e.id!==t})}(t.locations,e)}})}},{key:"moveLocationPoint",value:function(e,t){this.setState(function(n){return{locations:function(e,t,n){if(t<0||t>=e.length)throw new Error("RangeError: Trying to access the fromPosition being out of the locations array range");if(n<0||n>=e.length)throw new Error("RangeError: Trying to access the toPosition being out of the locations array range");var a=e.slice(0),o=a.splice(t,1)[0];return a.splice(n,0,o),a}(n.locations,e,t)}})}},{key:"updateLocationPoint",value:function(){var e=Object(l.a)(u.a.mark(function e(t,n){var a,o=this;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=function(e){return{locations:x(e.locations,t,n)}},r=n.coords,!Array.isArray(r)||0===r.length){e.next=7;break}return e.next=4,this.fetchPointAddress(n.coords);case 4:n.value=e.sent,e.next=11;break;case 7:if(!n.value){e.next=11;break}return e.next=10,this.fetchPointCoords(n.value);case 10:n.coords=e.sent;case 11:return e.abrupt("return",new Promise(function(e,t){try{o.setState(a,function(){e(n)})}catch(r){t(r)}}));case 12:case"end":return e.stop()}var r},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.activeView;return o.a.createElement("main",{className:"App"},o.a.createElement("div",{className:" App-InnerContainer App-InnerContainer_row App-InnerContainer_fluid "},o.a.createElement("div",{className:"\n            App-Dashboard\n            ".concat(M(A[0],e),"\n          ")},o.a.createElement(O,{onSubmit:this.addLocationPoint}),o.a.createElement(P,{onDragEnd:this.moveLocationPoint,onDelete:this.deleteLocationPoint,locations:this.state.locations})),o.a.createElement(j,{className:M(A[1],e),locations:this.state.locations,onWayPointDrag:this.updateLocationPoint})),o.a.createElement(L,{onToggle:this.toggleView,initialLabel:"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043a\u0430\u0440\u0442\u0443",toggledLabel:"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u043f\u0438\u0441\u043e\u043a \u0442\u043e\u0447\u0435\u043a"}))}}]),t}(a.Component),I=Object(c.withYMaps)(D,!0,["geocode"]);i.a.render(o.a.createElement(c.YMaps,{query:{apikey:"262287d2-a40d-4b35-b808-7d4231cb5915"}},o.a.createElement(I,null)),document.getElementById("root"))},51:function(e,t,n){e.exports=n(107)},52:function(e,t,n){},60:function(e,t,n){},62:function(e,t,n){},64:function(e,t,n){},66:function(e,t,n){}},[[51,2,1]]]);
//# sourceMappingURL=main.0b98082a.chunk.js.map